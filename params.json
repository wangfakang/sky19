{"name":"Sky19","tagline":"nginx about waf ","body":"`redis的pub\\sub介绍`\r\n\r\n  在之前的[动态upstream管理项目中](http://wangfakang.github.io/sky16/)有提到在进行集群管理nginx的动态upstream的时候是使用\r\n  consul相关组件来做得,其实我们也可以利用redis的pub\\sub机制来进行管理集群的nginx的动态upstream的下发.  \r\n\r\n基本原理:    \r\n====\r\n \r\n  * 1.nginx相关前端机的redis订阅主redis的相关信息.      \r\n  * 2.通过向主redis进行push相关后端机器节点操作信息.     \r\n  * 3.各个nginx上的redis获取到相关指令信息,然后触发相关操作.     \r\n\r\n简单实列:     \r\n====   \r\n订阅端:   \r\n 订阅端订阅了两个通道的消息.   \r\n```\r\nfakang@fakang-pc:~$ redis-cli \r\n127.0.0.1:6379> SUBSCRIBE china jappan\r\nReading messages... (press Ctrl-C to quit)\r\n1) \"subscribe\"\r\n2) \"china\"\r\n3) (integer) 1\r\n1) \"subscribe\"\r\n2) \"jappan\"\r\n3) (integer) 2\r\n\r\n\r\n1) \"message\"\r\n2) \"china\"\r\n3) \"hello\"\r\n\r\n```\r\n\r\n\r\n发布端:     \r\n  此时发布端向china的通道推送了一条消息.\r\n```\r\nfakang@fakang-pc:~$ redis-cli \r\n127.0.0.1:6379> PUBLISH china \"hello\"\r\n(integer) 1\r\n```\r\n注: 上面的这个interger: 1是表示此时只有一个成功订阅端订阅了china这个topic.   \r\n\r\nredis的pub\\sub的简单解析:   \r\n====   \r\n   \r\n  1.其实redis在发布端维护了一种表,这张表,这张表饿内容就是:以相关通道名称(如china  japan)为key,然后相关的订阅端为value\r\n  进行的一个hash表,如果同一个通道(如china)此时有两个client进行了订阅,则此时key为china的后面就是一个链表挂载了两个\r\n  client节点.     \r\n  2.发布端进行发布消息饿时候,找到相应的key然后遍历后面挂载饿链表依次进行发送消息.  \r\n  3.订阅端然后进行在队列中消费相应的消息.   \r\n\r\nCommunite  \r\n====\r\n \r\n在使用中有任何问题，欢迎反馈给我，可以用以下联系方式跟我交流\r\n\r\n* 邮件(1031379296#qq.com, 把#换成@)\r\n* QQ: 1031379296\r\n* weibo: [@王发康](http://weibo.com/fakangwang)\r\n\r\n\r\nThx\r\n====\r\n\r\n* chunshengsterATgmail.com\r\n\r\n\r\nAuthor\r\n====\r\n* Linux\\nginx\\golang\\c\\c++爱好者\r\n* 欢迎一起交流  一起学习# \r\n* Others say good and Others good\r\n","google":"redis pub  sub","note":"Don't delete this file! It's used internally to help with page regeneration."}